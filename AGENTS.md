# AI作業ルール - 施工BIM教材サイト

このドキュメントは、AIエージェントがこのプロジェクトで作業する際のルールと指針を定義します。

## 基本原則

### 1. 小さく作って動かす
- **必須**: 大きな変更を一度に行わない
- 1つの機能または1つのページを完成させたら、必ず動作確認する
- `make dev` でプレビューして問題がないことを確認してからコミット
- コミットメッセージは明確に（例: `feat: 躯体図チェックレシピページを追加`）

### 2. ビルドが通ることを保証
- **必須**: 変更後は必ず `make build` が成功することを確認
- エラーが出た場合は、必ず修正してからコミット
- `make test` でlintエラーがないことを確認

### 3. 大規模リファクタは禁止
- 既存の動作しているコードを大幅に書き換えることは避ける
- 必要な場合は、以下を明記：
  - リファクタの理由
  - 変更の影響範囲
  - テスト手順
  - ロールバック手順

## コミットメッセージ規約

以下のプレフィックスを使用：

- `feat:` - 新機能追加
- `fix:` - バグ修正
- `docs:` - ドキュメントのみの変更
- `style:` - コードの意味に影響しない変更（フォーマット等）
- `refactor:` - リファクタリング
- `test:` - テストの追加・修正
- `chore:` - ビルドプロセスや補助ツールの変更

例:
```
feat: 鉄筋納まり検討レシピページを追加
fix: PDF画像抽出スクリプトのエラー修正
docs: README.mdに起動手順を追記
```

## ファイル管理

### 画像ファイル
- **場所**: `docs/assets/images/pdfs/<pdf_name>/page_XXX.png`
- **命名規則**: `page_001.png`, `page_002.png` のように3桁のゼロパディング
- **サイズ**: 通常は150dpiで抽出（詳細が必要な場合は300dpi）
- **Git管理**: 現在は通常のGit管理（将来的にGit LFSの検討も可）

### メタデータファイル
- **場所**: `data/metadata/<pdf_name>.yaml`
- **フォーマット**: YAML
- **必須フィールド**:
  - `page`: ページ番号
  - `filename`: 画像ファイル名
  - `title`: ページタイトル
  - `use_in`: 使用箇所のリスト
  - `description`: ページの説明

### Markdownファイル
- **場所**: `docs/` 配下
- **エンコーディング**: UTF-8
- **改行**: LF（Unix形式）
- **インデント**: スペース2個（YAMLフロントマター含む）

## ページ作成ルール

### 全ページ共通
すべてのレッスンページには以下を含める：

1. **YAMLフロントマター**:
```yaml
---
title: ページタイトル
description: ページの説明
tags:
  - 施工図
  - BIM
---
```

2. **必須セクション**:
   - 目的（1文）
   - 前提知識（施工図側の前提）
   - 画像（1〜2枚、拡大可能）
   - 講師ノート（箇条書き）
   - 用語（ツールチップ）
   - NG事例（やらないと何が起きるか）
   - 小テスト（3〜5問）

### BIM活用レシピページ
以下のテンプレートを使用：

```markdown
---
title: レシピ名
description: 簡潔な説明
tags:
  - BIM活用
  - レシピ
---

# レシピ名

## 📋 概要

**目的**: （1文で）

**工程**: 躯体工事 / 仕上工事 / etc.

**担当**: 元請 / 専門工事会社 / etc.

## 🎯 前提知識（施工図）

- 必要な施工図の知識1
- 必要な施工図の知識2

## 📸 図解

![説明](../assets/images/pdfs/xxx/page_001.png)

!!! note "講師が必ず言う5点"
    1. **工程**: どの工程か
    2. **担当**: 誰の仕事か
    3. **目的**: 何を決めるためか
    4. **施工図との関係**: どの情報と関係するか
    5. **NG事例**: やらないと何が起きるか

## 📝 手順

1. ステップ1
2. ステップ2
3. ステップ3

## 💡 講師ノート

- 説明のポイント1
- 説明のポイント2
- 注意点

## 📖 用語

- **用語1**: 説明
- **用語2**: 説明

## ❌ NG事例

### やらないとこうなる

- 問題1
- 問題2

## ✅ 小テスト

1. 質問1
   - [ ] 選択肢A
   - [ ] 選択肢B
   - [x] 選択肢C（正解）

2. 質問2
   ...
```

## 画像の使用方法

### 基本的な画像挿入
```markdown
![説明テキスト](../assets/images/pdfs/施工BIM③/page_005.png)
```

### 拡大可能な画像（カスタムCSS使用）
```markdown
<div class="image-zoom">
  <img src="../assets/images/pdfs/施工BIM③/page_005.png" alt="説明">
  <p class="caption">図1: キャプション</p>
</div>
```

### 複数画像の並列表示
```markdown
<div class="image-grid">
  <div class="image-item">
    <img src="image1.png" alt="説明1">
    <p>説明1</p>
  </div>
  <div class="image-item">
    <img src="image2.png" alt="説明2">
    <p>説明2</p>
  </div>
</div>
```

## 著作権とライセンス

### PDF画像の使用
- 使用するPDFは日本建設業連合会（日建連）発行の資料
- 教育目的での使用
- 必ず出典を明記する：

```markdown
!!! info "出典"
    施工BIMの活用ガイド 増補版  
    一般社団法人 日本建設業連合会 建築生産委員会 BIM部会
```

## テストとデバッグ

### ローカルプレビュー
```bash
make dev
# http://localhost:8000 でアクセス
```

### ビルドテスト
```bash
make build
# site/ ディレクトリに成果物が生成される
```

### Lintテスト
```bash
make test
# flake8とblackでコード品質をチェック
```

## デプロイ

### GitHub Pagesへのデプロイ
```bash
make deploy
# gh-pagesブランチに自動デプロイ
```

### デプロイ前チェックリスト
- [ ] `make build` が成功する
- [ ] `make test` が成功する
- [ ] すべての画像リンクが正しい
- [ ] ナビゲーションが動作する
- [ ] モバイル表示が問題ない

## トラブルシューティング

### よくある問題

1. **画像が表示されない**
   - パスが正しいか確認（相対パス）
   - 画像ファイルが実際に存在するか確認

2. **ビルドエラー**
   - YAMLフロントマターの文法エラー
   - Markdownの文法エラー
   - 壊れた内部リンク

3. **日本語が文字化け**
   - ファイルのエンコーディングがUTF-8になっているか確認

## 変更履歴の記録

重要な変更は `CHANGELOG.md` に記録：

```markdown
## [Unreleased]

### Added
- 鉄筋納まり検討レシピページを追加

### Fixed
- PDF画像抽出スクリプトのバグ修正

### Changed
- 用語集のレイアウト改善
```

## コードレビューのポイント

AIエージェントが作業した内容は、以下の観点で確認すること：

- [ ] ビルドが通る
- [ ] テストが通る
- [ ] 命名規則に従っている
- [ ] 必須セクションが全て含まれている
- [ ] 画像が適切に配置されている
- [ ] 出典が明記されている
- [ ] 講師ノートが含まれている
- [ ] 小テストが3〜5問ある

---

**最終更新**: 2025-12-31  
**バージョン**: 1.0.0
